<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Movie2Comic</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@5.8.55/css/materialdesignicons.min.css">
	<link rel="stylesheet" href="https://unpkg.com/ant-design-vue@2.0.0-rc.4/dist/antd.min.css">
	<link rel="stylesheet" href="css/site.css">
</head>

<body>
	<div id="app">
		<a-layout>
			<a-layout-header :style="{ background: '#fff' }">
				<h1>Movie2Comic</h1>
				<a-menu theme="light">
				</a-menu>
			</a-layout-header>
			<a-layout-content style="min-height: 100vh; margin-top: 30px">
				<a-row type="flex" justify="center" align="top">
					<a-col :span="18">
						<a-space direction="vertical" style="width: 100%;">
							<a-steps v-model:current="selectedStep" type="navigation">
								<a-step :status="getStageStatus(stages.Create)" title="Start"
									description="Create project">
								</a-step>
								<a-step :status="getStageStatus(stages.Frame)" title="Keyframes"
									description="Extract frames" :disabled="stages.Frame > processStage">
								</a-step>
								<a-step :status="getStageStatus(stages.Subtitle)" title="Subtitles"
									description="Generate subtitles" :disabled="stages.Subtitle > processStage">
								</a-step>
								<a-step :status="getStageStatus(stages.Style)" title="Styles"
									description="Transfer styles" :disabled="stages.Style > processStage">
								</a-step>
								<a-step :status="getStageStatus(stages.Output)" title="Comic"
									description="Get the comic" :disabled="stages.Output > processStage">
								</a-step>
							</a-steps>
							<div>
								<div v-show="selectedStage == stages.Create || selectedStage == stages.Input">
									<div v-if="!sessionId">
										<a-space direction="vertical" style="width: 100%;">
											<a-space>
												<a-radio-group v-model:value="pages.start.type" button-style="solid"
													size="large">
													<a-radio-button :value="0">
														New
													</a-radio-button>
													<a-radio-button :value="1">
														Existed
													</a-radio-button>
												</a-radio-group>
												<a-switch v-model:checked="pages.start.auto" checked-children="Auto"
													un-checked-children="Manual" />
											</a-space>
											<div>
												<a-upload-dragger v-if="pages.start.type == 0" :action="sessionRootUrl"
													name="file" @change="onStartNew">
													<p class="ant-upload-drag-icon">
														<span class="mdi mdi-upload" style="font-size:xx-large;"></span>
													</p>
													<p class="ant-upload-text">
														Click or drag file to this area to upload
													</p>
													<p class="ant-upload-hint">
														Only one video file is allowed.
													</p>
												</a-upload-dragger>
												<div v-else>
													<a-input placeholder="session ID" v-model:value="pages.start.sid">
														<template v-slot:suffix>
															<a-button type="primary" @click="onStartExisted">OK
															</a-button>
														</template>
													</a-input>
												</div>
											</div>
										</a-space>

									</div>
									<div v-else>
										Your session ID is {{ sessionId }}
										<br />
										<video v-if="!!sessionId" controls :src="videoUrl" style="width: 100%;"></video>
									</div>
								</div>
								<div v-show="selectedStage == stages.Frame">
									<a-space direction="vertical" style="width: 100%;">
										<a-button @click="onWorkFrames" size="large" style="width: 100%;"
											:loading="state == states.OnFrame" :disabled="state == states.OnFrame">
											{{ state > states.OnFrame ? "Information" : "Extract"}}
										</a-button>
										<a-card title="Frames">
											<a-card-grid v-for="frame in pages.frames.result.frames"
												@click="onPreviewFrame(frame)" style="width:25%;text-align:center">
												<img :src="frameImageUrl(frame.name)" style="width: 100%" />
												<a-card-meta :title="readableSecondTimeString(frame.time)">
												</a-card-meta>
											</a-card-grid>
										</a-card>
										<a-drawer title="Frame Extracting Result" placement="right" :closable="false"
											width="512" v-model:visible="pages.frames.info.enable">
											<a-result :status="pages.frames.result.success ? 'success' : 'error'"
												:title="readableSecondTimeString(pages.frames.result.duration)"
												:sub-title="pages.frames.result.log">
											</a-result>
										</a-drawer>
									</a-space>
									<a-modal width="1080px" v-model:visible="pages.frames.preview.enable"
										:title="`${pages.frames.preview.frame.name} ${readableSecondTimeString(pages.frames.preview.frame.time)}`"
										:footer="null">
										<img :src="frameImageUrl(pages.frames.preview.frame.name)"
											style="width: 100%" />
									</a-modal>
								</div>
								<div v-show="selectedStage == stages.Subtitle">
									<a-space direction="vertical" style="width: 100%;">
										<a-button @click="onWorkSubtitles" size="large" style="width: 100%;"
											:loading="state == states.OnSubtitle"
											:disabled="state == states.OnSubtitle">
											{{ state > states.OnSubtitle ? "Information" : "Generate"}}
										</a-button>

										<div style="text-align: right;">
											<a-switch v-model:checked="pages.subtitles.isZhcn" checked-children="zh-CN"
											un-checked-children="en-US" :disabled="state >= states.OnSubtitle" />
										</div>
										

										<a-card title="Subtitles">
											<a-card-grid v-for="subtitle in pages.subtitles.result.subtitles"
												@click="onPreviewSubtitle(subtitle)" style="width:100%;">
												<a-card-meta :title="subtitle.text"
													:description="`${readableSecondTimeString(subtitle.start)} ~ ${readableSecondTimeString(subtitle.end)}`">
												</a-card-meta>
											</a-card-grid>
											<a-modal width="1080px" v-model:visible="pages.subtitles.preview.enable"
												:title="`${pages.subtitles.preview.subtitle.name} ${readableSecondTimeString(pages.subtitles.preview.subtitle.start)} ~ ${readableSecondTimeString(pages.subtitles.preview.subtitle.end)}`"
												:footer="null">
												<h1> {{ pages.subtitles.preview.subtitle.text }} </h1>
												</br>
												<audio controls
													:src="subtitleAudioUrl(pages.subtitles.preview.subtitle.name)"
													style="width: 100%"></audio>
											</a-modal>
										</a-card>
									</a-space>
									<a-drawer title="Subtitles Generating Result" placement="right" :closable="false"
										width="512" v-model:visible="pages.subtitles.info.enable">
										<a-result :status="pages.subtitles.result.success ? 'success' : 'error'"
											:title="readableSecondTimeString(pages.subtitles.result.duration)"
											:sub-title="pages.subtitles.result.log">
										</a-result>
									</a-drawer>
								</div>
								<div v-show="selectedStage == stages.Style">
									<a-space direction="vertical" style="width: 100%;">
										<a-button @click="onWorkStyles" size="large" style="width: 100%;"
											:loading="state == states.OnStyle" :disabled="state == states.OnStyle">
											{{ state > states.OnStyle ? "Information" : "Transfer"}}
										</a-button>
										<a-card title="Styled Frames">
											<a-card-grid v-for="frame in pages.styles.result.frames"
												@click="onPreviewStyledFrame(frame)"
												style="width:25%;text-align:center">
												<img :src="styledFrameImageUrl(frame.name)" style="width: 100%" />
											</a-card-grid>
										</a-card>
									</a-space>
									<a-modal width="1080px" v-model:visible="pages.styles.preview.enable"
										:title="`${pages.styles.preview.frame.name}`" :footer="null">
										<img :src="styledFrameImageUrl(pages.styles.preview.frame.name)"
											style="width: 100%" />
									</a-modal>
									<a-drawer title="Style Transferring Result" placement="right" :closable="false"
										width="512" v-model:visible="pages.styles.info.enable">
										<a-result :status="pages.styles.result.success ? 'success' : 'error'"
											:title="readableSecondTimeString(pages.styles.result.duration)"
											:sub-title="pages.styles.result.log">
										</a-result>
									</a-drawer>
								</div>
								<div v-show="selectedStage == stages.Output">
									<a-space direction="vertical" style="width: 100%;">
										<a-button @click="onWorkComics" size="large" style="width: 100%;"
											:loading="state == states.OnOutput" :disabled="state == states.OnOutput">
											{{ state > states.OnOutput ? "Information" : "Combine"}}
										</a-button>
										<a-card title="Comic">
											<img :src="comicsFileUrl(pages.comics.result.file)" style="width: 100%" />
										</a-card>
									</a-space>
									<a-drawer title="Comic Combination Result" placement="right" :closable="false"
										width="512" v-model:visible="pages.comics.info.enable">
										<a-result :status="pages.comics.result.success ? 'success' : 'error'"
											:title="readableSecondTimeString(pages.comics.result.duration)"
											:sub-title="pages.comics.result.log">
										</a-result>
									</a-drawer>
								</div>
							</div>
						</a-space>
					</a-col>
				</a-row>


			</a-layout-content>
			<a-layout-footer>
				Copyright <span class="mdi mdi-copyright"></span> 2020 -
				Movie2Comic - StardustDL - <a href="https://github.com/StardustDL/movie2comic"><span
						class="mdi mdi-github"></span>
					GitHub</a>
			</a-layout-footer>
		</a-layout>
	</div>

	<script src="https://unpkg.com/vue@3.0.4"></script>
	<script src="https://unpkg.com/ant-design-vue@2.0.0-rc.4/dist/antd.min.js"></script>

	<script src="js/site.js" type="text/javascript" charset="utf-8"></script>
</body>

</html>